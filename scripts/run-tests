#!/usr/bin/env bash
#
# Run dotfiles test suite using bats-core
#
# Usage: run-tests [category]
#   category: all (default), git, abbr

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(dirname "${SCRIPT_DIR}")"

if [[ "$(pwd)" != "${PROJECT_ROOT}" ]]; then
  echo "Error: run-tests must be run from the dotfiles directory" >&2
  echo "Usage: cd ${PROJECT_ROOT} && ./scripts/run-tests" >&2
  exit 1
fi

if ! command -v bats >/dev/null 2>&1; then
  echo "Error: bats-core not found. Run: brew install bats-core" >&2
  exit 1
fi

category="${1:-all}"

case "${category}" in
  all)
    echo "Running all tests..."
    bats tests/ --recursive
    ;;
  git)
    echo "Running git function tests..."
    bats tests/git_functions/
    ;;
  abbr)
    echo "Running abbreviation tests..."
    bats tests/abbreviations/
    ;;
  *)
    echo "Unknown category: ${category}" >&2
    echo "Available: all, git, abbr" >&2
    exit 1
    ;;
esac
